"{
  \"kpi_measurements\": [
    {
      \"kpi_code\": \"KPI-001\",
      \"measurement\": {
        \"metric_name\": \"Sprint Completion Rate\",
        \"definition\": \"อัตราส่วนของ user stories ที่เสร็จสมบูรณ์ภายใน sprint\",
        \"formula\": \"(completed user stories / total user stories) * 100\",
        \"unit\": \"percent\",
        \"frequency\": \"monthly\",
        \"data_sources\": [\"Jira\"],
        \"target\": {
          \"direction\": \"at_least\",
          \"value\": 85,
          \"rationale\": \"เพื่อให้สามารถส่งมอบงานได้ตามความคาดหวัง\"
        },
        \"checklist\": [],
        \"scoring\": [
          {
            \"condition\": \">= 95 percent\",
            \"score\": 5
          },
          {
            \"condition\": \"90–94.99 percent\",
            \"score\": 4
          },
          {
            \"condition\": \"80–89.99 percent\",
            \"score\": 3
          },
          {
            \"condition\": \"70–79.99 percent\",
            \"score\": 2
          },
          {
            \"condition\": \"< 70 percent\",
            \"score\": 1
          }
        ],
        \"notes\": \"\"
      }
    },
    {
      \"kpi_code\": \"KPI-002\",
      \"measurement\": {
        \"metric_name\": \"Average Story Points Completed\",
        \"definition\": \"ค่าเฉลี่ยของ story points ที่ทำได้ในแต่ละ sprint\",
        \"formula\": \"(total story points completed / number of sprints)\",
        \"unit\": \"points\",
        \"frequency\": \"monthly\",
        \"data_sources\": [\"Jira\"],
        \"target\": {
          \"direction\": \"at_least\",
          \"value\": 20,
          \"rationale\": \"เพื่อเพิ่มความสามารถในการวางแผนและพัฒนา\"
        },
        \"checklist\": [],
        \"scoring\": [
          {
            \"condition\": \">= 25 points\",
            \"score\": 5
          },
          {
            \"condition\": \"20–24.99 points\",
            \"score\": 4
          },
          {
            \"condition\": \"15–19.99 points\",
            \"score\": 3
          },
          {
            \"condition\": \"10–14.99 points\",
            \"score\": 2
          },
          {
            \"condition\": \"< 10 points\",
            \"score\": 1
          }
        ],
        \"notes\": \"\"
      }
    },
    {
      \"kpi_code\": \"KPI-003\",
      \"measurement\": {
        \"metric_name\": \"Post-Deployment Incident Rate\",
        \"definition\": \"จำนวน incident ที่เกิดขึ้นหลังการ deploy ไปยัง production\",
        \"formula\": \"total incidents after deployment\",
        \"unit\": \"count\",
        \"frequency\": \"monthly\",
        \"data_sources\": [\"Monitoring\"],
        \"target\": {
          \"direction\": \"at_most\",
          \"value\": 5,
          \"rationale\": \"เพื่อรักษาความเสถียรของระบบ\"
        },
        \"checklist\": [],
        \"scoring\": [
          {
            \"condition\": \"<= 1 incident\",
            \"score\": 5
          },
          {
            \"condition\": \"2–3 incidents\",
            \"score\": 4
          },
          {
            \"condition\": \"4–5 incidents\",
            \"score\": 3
          },
          {
            \"condition\": \"6–8 incidents\",
            \"score\": 2
          },
          {
            \"condition\": \"> 8 incidents\",
            \"score\": 1
          }
        ],
        \"notes\": \"\"
      }
    },
    {
      \"kpi_code\": \"KPI-004\",
      \"measurement\": {
        \"metric_name\": \"Bug Fix Rate\",
        \"definition\": \"อัตราการแก้ไข bug ที่พบใน production\",
        \"formula\": \"(fixed bugs / total reported bugs) * 100\",
        \"unit\": \"percent\",
        \"frequency\": \"monthly\",
        \"data_sources\": [\"Jira\"],
        \"target\": {
          \"direction\": \"at_least\",
          \"value\": 90,
          \"rationale\": \"เพื่อให้ผู้ใช้ได้รับประสบการณ์ที่ดี\"
        },
        \"checklist\": [],
        \"scoring\": [
          {
            \"condition\": \">= 95 percent\",
            \"score\": 5
          },
          {
            \"condition\": \"90–94.99 percent\",
            \"score\": 4
          },
          {
            \"condition\": \"80–89.99 percent\",
            \"score\": 3
          },
          {
            \"condition\": \"70–79.99 percent\",
            \"score\": 2
          },
          {
            \"condition\": \"< 70 percent\",
            \"score\": 1
          }
        ],
        \"notes\": \"\"
      }
    },
    {
      \"kpi_code\": \"KPI-005\",
      \"measurement\": {
        \"metric_name\": \"Code Review Efficiency\",
        \"definition\": \"เวลาเฉลี่ยในการ review pull requests\",
        \"formula\": \"total review time / number of pull requests\",
        \"unit\": \"hours\",
        \"frequency\": \"monthly\",
        \"data_sources\": [\"GitHub\"],
        \"target\": {
          \"direction\": \"at_most\",
          \"value\": 24,
          \"rationale\": \"เพื่อลดเวลาที่ใช้ในกระบวนการพัฒนา\"
        },
        \"checklist\": [],
        \"scoring\": [
          {
            \"condition\": \"<= 10 hours\",
            \"score\": 5
          },
          {
            \"condition\": \"11–15 hours\",
            \"score\": 4
          },
          {
            \"condition\": \"16–20 hours\",
            \"score\": 3
          },
          {
            \"condition\": \"21–24 hours\",
            \"score\": 2
          },
          {
            \"condition\": \"> 24 hours\",
            \"score\": 1
          }
        ],
        \"notes\": \"\"
      }
    },
    {
      \"kpi_code\": \"KPI-006\",
      \"measurement\": {
        \"metric_name\": \"Code Quality Index\",
        \"definition\": \"คะแนนคุณภาพของโค้ดตามการวิเคราะห์โดยเครื่องมืออัตโนมัติ\",
        \"formula\": null,
        \"unit\": \"percent\",
        \"frequency\": \"monthly\",
        \"data_sources\": [\"GitHub\"],
        \"target\": {
          \"direction\": \"at_least\",
          \"value\": 80,
          \"rationale\": \"การมีคุณภาพโค้ดที่ดีช่วยลดความจำเป็นในการแก้ไขซ้ำ\"
        },
        \"checklist\": [],
        \"scoring\": [
          {
            \"condition\": \">= 90 percent\",
            \"score\": 5
          },
          {
            \"condition\": \"80–89.99 percent\",
            \"score\": 4
          },
          {
            \"condition\": \"70–79.99 percent\",
            \"score\": 3
          },
          {
            \"condition\": \"60–69.99 percent\",
            \"score\": 2
          },
          {
            \"condition\": \"< 60 percent\",
            \"score\": 1
          }
        ],
        \"notes\": \"\"
      }
    },
    {
      \"kpi_code\": \"KPI-007\",
      \"measurement\": {
        \"metric_name\": \"Deployment Frequency\",
        \"definition\": \"จำนวนครั้งที่มีการ deploy code ในช่วงเวลาที่กำหนด\",
        \"formula\": \"total deployments in the timeframe\",
        \"unit\": \"count\",
        \"frequency\": \"monthly\",
        \"data_sources\": [\"CI/CD\"],
        \"target\": {
          \"direction\": \"at_least\",
          \"value\": 4,
          \"rationale\": \"การ deploy อย่างต่อเนื่องช่วยเพิ่มการตอบสนองทางธุรกิจ\"
        },
        \"checklist\": [],
        \"scoring\": [
          {
            \"condition\": \">= 8 deployments\",
            \"score\": 5
          },
          {
            \"condition\": \"6–7 deployments\",
            \"score\": 4
          },
          {
            \"condition\": \"4–5 deployments\",
            \"score\": 3
          },
          {
            \"condition\": \"2–3 deployments\",
            \"score\": 2
          },
          {
            \"condition\": \"< 2 deployments\",
            \"score\": 1
          }
        ],
        \"notes\": \"\"
      }
    }
  ]
}"

----------------------------------------------------------------------------------
; Promt
{
  "model": "gpt-4o-mini",
  "messages": [
    {
      "role": "system",
      "content": "คุณเป็นผู้เชี่ยวชาญด้านการออกแบบ KPI องค์กร หน้าที่ของคุณคือออกแบบ KPI ให้เหมาะกับตำแหน่งงานและวัดผลได้จริง ตอบเป็น JSON เท่านั้นตาม schema ที่กำหนด ห้ามมีข้อความอื่นนอก JSON ห้ามใช้ markdown/code fence"
    },
    {
      "role": "user",
      "content": "บริบทเพิ่มเติม (ใช้เพื่อกำหนดเกณฑ์วัดผล):
      - ตำแหน่งงาน: Software Engineer (Backend)
      - ระดับ: Mid-level
      - แหล่งข้อมูลที่ใช้วัดผลได้จริง:
        - Jira
        - GitHub
        - Monitoring
        - CI/CD
      
      รายการ KPI ระดับที่ 2 (ได้จากรอบแรก):
      [
        {
          'kpi_code': 'KPI-001',
          'title': 'Sprint Completion Rate',
          'description': 'อัตราส่วนของ user stories ที่เสร็จสมบูรณ์ภายใน sprint',
          'kpi_type': 'quantitative',
          'timeframe': 'monthly',
          'data_sources': ['Jira'],
          'why_it_matters': 'ช่วยให้ทราบถึงความสามารถในการส่งมอบงานตามกำหนดเวลา'
        },
        {
          'kpi_code': 'KPI-002',
          'title': 'Average Story Points Completed',
          'description': 'ค่าเฉลี่ยของ story points ที่ทำได้ในแต่ละ sprint',
          'kpi_type': 'quantitative',
          'timeframe': 'monthly',
          'data_sources': ['Jira'],
          'why_it_matters': 'สามารถใช้วัดประสิทธิภาพการทำงานและการวางแผนในอนาคต'
        },
        {
          'kpi_code': 'KPI-003',
          'title': 'Post-Deployment Incident Rate',
          'description': 'จำนวน incident ที่เกิดขึ้นหลังการ deploy ไปยัง production',
          'kpi_type': 'quantitative',
          'timeframe': 'monthly',
          'data_sources': ['Monitoring'],
          'why_it_matters': 'ลด incident ส่งผลต่อความเชื่อมั่นของผู้ใช้และความเสถียรของระบบ'
        },
        {
          'kpi_code': 'KPI-004',
          'title': 'Bug Fix Rate',
          'description': 'อัตราการแก้ไข bug ที่พบใน production',
          'kpi_type': 'quantitative',
          'timeframe': 'monthly',
          'data_sources': ['Jira'],
          'why_it_matters': 'ช่วยลดปัญหาที่เกิดจาก bug และส่งเสริมการใช้งานที่ดีขึ้น'
        },
        {
          'kpi_code': 'KPI-005',
          'title': 'Code Review Efficiency',
          'description': 'เวลาเฉลี่ยในการ review pull requests',
          'kpi_type': 'quantitative',
          'timeframe': 'monthly',
          'data_sources': ['GitHub'],
          'why_it_matters': 'การเร่งเวลาใน review ช่วยเพิ่มประสิทธิภาพในกระบวนการพัฒนา'
        },
        {
          'kpi_code': 'KPI-006',
          'title': 'Code Quality Index',
          'description': 'คะแนนคุณภาพของโค้ดตามการวิเคราะห์โดยเครื่องมืออัตโนมัติ',
          'kpi_type': 'qualitative',
          'timeframe': 'monthly',
          'data_sources': ['GitHub'],
          'why_it_matters': 'การมีคุณภาพโค้ดที่ดีช่วยลดความจำเป็นในการแก้ไขซ้ำ'
        },
        {
          'kpi_code': 'KPI-007',
          'title': 'Deployment Frequency',
          'description': 'จำนวนครั้งที่มีการ deploy code ในช่วงเวลาที่กำหนด',
          'kpi_type': 'quantitative',
          'timeframe': 'monthly',
          'data_sources': ['CI/CD'],
          'why_it_matters': 'การ deploy อย่างต่อเนื่องช่วยเพิ่มการตอบสนองทางธุรกิจและกำหนดเวลาในการพัฒนา'
        }
      ]งานที่ต้องทำ:
      - เติม 'เกณฑ์วัดผล (measurement)' ให้ KPI ทุกข้อด้านบน
      - ห้ามสร้าง KPI ใหม่
      - ห้ามแก้ไข title / description / kpi_type / timeframe
      - KPI แบบ quantitative:
        - ต้องมีสูตรคำนวณ (formula)
        - ต้องมี target เป็นตัวเลข
      - KPI แบบ qualitative:
        - ต้องมี rubric หรือเกณฑ์ให้คะแนนชัดเจน (เช่น 1–5)
      - KPI แบบ custom:
        - ต้องอธิบายวิธีวัดอย่างชัดเจน
      
      ข้อกำหนดการตอบ:
      - ตอบเป็น JSON เท่านั้น
      - ต้องตรง schema ด้านล่างแบบเคร่งครัด
      - ห้ามมีข้อความอื่นนอก JSON
      - หากไม่สามารถกำหนดเกณฑ์ได้ ให้ใส่เหตุผลสั้น ๆ ใน field 'notes'
      - ถ้าทำตามไม่ได้ ให้ตอบ '{}' เท่านั้น
      
      schema (ต้องใช้ key ตามนี้เท่านั้น):
      {
        'kpi_measurements': [
          {
            'kpi_code': 'string',
            'measurement': {
              'metric_name': 'string',
              'definition': 'string',
              'formula': 'string | null',
              'unit': 'string',
              'frequency': 'weekly | monthly | quarterly',
              'data_sources': ['Jira | GitHub | Monitoring | CICD'],
              'target': {
                'direction': 'at_least | at_most | range',
                'value': 'number | string',
                'rationale': 'string'
              },
       'checklist': [{ 'item': 'string', 'weight_percent': 30 }],
             'scoring': [
                {
                  'condition': 'string',
                  'score': 'number'
                }
              ],
              'notes': 'string'
            }
          }
        ]
      }
      
      หมายเหตุ:
      - 'kpi_code' ต้องตรงกับรายการที่ให้มา
      - 'scoring' กติกาการสร้าง scoring (สำคัญมาก ต้องทำให้ครบทุก KPI):ต้องสร้าง scoring ให้ครบทุก KPI และต้องมีระดับคะแนน 5 ระดับเสมอ (score = 1,2,3,4,5) ห้ามเว้น scoring ว่าง และห้ามทำคะแนนแบบอื่นนอกจาก 1–5 unit ต้องมีเสมอ (ถ้าเป็นเปอร์เซ็นต์ให้ใช้ 'percent, ถ้าเป็นจำนวนให้ใช้ 'count', ถ้าเป็นเวลาให้ใช้ 'hours/days', ฯลฯ) รายละเอียดตามประเภท KPI:1) ถ้า kpi_type = quantitative ต้องมี formula เป็น string (ห้ามเป็น null) unit ต้องเป็นหน่วยที่สอดคล้องกับ metric (เช่น percent, count, minutes, points) scoring ต้องเป็นเกณฑ์ 5 ระดับที่เป็น 'ตัวเลข + หน่วย' ชัดเจน ตัวอย่างรูปแบบ condition:'>= 95 percent' '90–94.99 percent' '80–89.99 percent' '70–79.99 percent' '< 70 percent' 2) ถ้า kpi_type = custom formula สามารถเป็น null ได้ unit ให้ใช้ 'level' หรือหน่วยที่เหมาะสม scoring ต้องเป็นคำอธิบาย 5 ระดับ (1–5) แบบข้อความล้วน ตัวอย่างรูปแบบ condition: 'ระดับ 5: ทำได้ครบ... + มีการปรับปรุง...' 'ระดับ 4: ...'...'ระดับ 1: ...'3) ถ้า kpi_type = qualitative formula ต้องเป็น null unit ให้ใช้ 'percent' (คิดคะแนนจาก checklist) scoring ต้องเป็น checklist ของกิจกรรม โดยแต่ละกิจกรรมมีเปอร์เซ็นต์คะแนน รวมกัน = 100% ใน field scoring ให้เขียนเป็น 5 ระดับ 1–5 โดยใช้ condition เป็น 'เปอร์เซ็นต์รวมที่ทำได้สำเร็จ'และใน notes ให้แนบ checklist พร้อม % ของแต่ละกิจกรรมแบบชัดเจน ตัวอย่าง: scoring: '>= 90 percent' => score 5, '80–89.99 percent' => 4, ... notes: 'Checklist: (1) ทำ PR review ตาม guideline 30% (2) ... 25% ... รวม 100%' ข้อกำหนดเพิ่มเติม: frequency ต้องตรงกับ timeframe ของ KPI ที่ได้รับมา (weekly/monthly/quarterly) data_sources ใน measurement ต้องเป็น subset ของ data_sources ของ KPI ข้อนั้น (ห้ามเพิ่มแหล่งข้อมูลใหม่) ห้ามแก้ไข title/description/kpi_type/timeframe 
      
      เริ่มตอบได้เลย"
    }
  ]
}